<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Photorealistic Office Render Prompt Builder</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      font-size: 18px;
      padding: 1rem;
      background-color: #111;
      color: white;
      overflow: hidden;
    }
    .container {
      display: flex;
      align-items: flex-start;
      flex-wrap: nowrap;
      height: 99vh;
      overflow: hidden;
    }
    .scrollable-form {
      max-height: 99vh;
      overflow-y: auto;
      padding-right: 1rem;
      flex: 0 0 35%;
    }
    .form-section {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
    }
    .form-group {
      background: #222;
      padding: 1rem;
      border-radius: 10px;
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #444;
    }
    label {
      font-weight: bold;
      margin-bottom: 0.5rem;
      display: block;
      color: white;
      font-size: 18px;
    }
    select[multiple], textarea, select, input[type="text"] {
      width: 100%;
      padding: 0.5rem;
      border-radius: 5px;
      border: 1px solid #666;
      background: black;
      color: white;
      font-size: 19px;
    }
    .output-section {
      background: #444;
      padding: 1rem;
      border-radius: 10px;
      flex: 1;
      box-sizing: border-box;
      position: sticky;
      top: 1rem;
      align-self: flex-start;
      margin-left: 0;
    }
    .output {
      background: black;
      color: white;
      padding: 1rem;
      border-radius: 8px;
      font-family: monospace;
      height: 200px;
      overflow-y: auto;
      border: 1px solid #555;
      width: 100%;
      box-sizing: border-box;
      font-size: 18px;
    }
    .button-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.5rem 1.5rem;
      border-radius: 5px;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    .labels-box {
      background: #1e1e1e;
      margin-top: 1rem;
      border-radius: 8px;
      padding: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .label-tag {
      padding: 0.4rem 0.75rem;
      border-radius: 20px;
      font-size: 15px;
      background-color: #666;
      color: white;
    }
    .preview-box {
      margin-top: 1rem;
      background: #222;
      border-radius: 8px;
      height: 300px;
      overflow: auto;
      position: relative;
      cursor: grab;
    }

.preview-canvas {
  width: 3000px;
  height: 3000px;
  position: absolute;
  top: 0;
  left: 0;
  transform-origin: top left;
  transition: transform 0.05s ease-out;
}

.preview-image-wrapper {
  position: absolute;
  border: 1px solid #555;
  background: #111;
  border-radius: 4px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.6);
  resize: both;
  overflow: auto;
}

.preview-image-wrapper.selected {
  /* outline: 3px solid #4ecdc4; */
  outline: 3px solid #6cb2eb;
  outline-offset: -2px;
}


.preview-image-wrapper img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: contain;
  user-select: none;
  pointer-events: none;
}
.selected-image {
  outline: 3px solid #6cb2eb;
}


    .moodboard {
      display: flex;
      flex-wrap: wrap;
      gap: 1px;
    }
    .moodboard img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #888;
    }
  </style>
</head>
<body>
<!-- <h1>Photorealistic Office Render Prompt Builder</h1> -->
<div class="container">
    <div class="scrollable-form">
        <div class="form-section">
          <div class="form-group"><label for="officeSpaceType">Office Space Type</label><select id="officeSpaceType" multiple onchange="handleSearch(this, 'office type'); updateLabels(); updatePinterestQuery();"></select></div>
          <div class="form-group"><label for="intendedUse">Intended Use</label><select id="intendedUse" multiple onchange="handleSearch(this, 'office use case'); updateLabels()"></select></div>
          <div class="form-group"><label for="designStyle">Design Style</label><select id="designStyle" multiple onchange="handleSearch(this, 'interior office style'); updateLabels(); updatePinterestQuery();"></select></div>
          <div class="form-group"><label for="people">Number of People</label><select id="people" onchange="updateLabels()">
            <option>2-4</option><option>4-6</option><option>6-10</option><option>10-20</option><option>20-50</option><option>50+</option>
          </select></div>
          <div class="form-group"><label for="furniture">Furniture</label><textarea id="furniture" rows="6" onchange="updateLabels()"></textarea></div>
          <div class="form-group"><label for="materials">Primary Materials</label><select id="materials" multiple onchange="handleSearch(this, 'materials used in interiors'); updateLabels(); updatePinterestQuery();"></select></div>
          <div class="form-group"><label for="accentMaterials">Accent Materials</label><select id="accentMaterials" multiple onchange="handleSearch(this, 'accent materials interior'); updateLabels()"></select></div>
          <div class="form-group"><label for="primaryColor">Primary Color</label><select id="primaryColor" multiple onchange="handleSearch(this, 'interior color'); updateLabels(); updatePinterestQuery();"></select></div>
          <div class="form-group"><label for="accentColors">Accent Colors</label><select id="accentColors" multiple onchange="handleSearch(this, 'interior accent colors'); updateLabels()"></select></div>
          <div class="form-group"><label for="lightingType">Lighting Type</label><select id="lightingType" multiple onchange="handleSearch(this, 'lighting design office'); updateLabels(); updatePinterestQuery();"></select></div>
          <div class="form-group"><label for="lightingElements">Lighting Elements</label><select id="lightingElements" multiple onchange="handleSearch(this, 'lighting fixtures'); updateLabels()"></select></div>
        </div>
      </div>
      <div class="output-section">
        <div class="button-row">
          <button onclick="generatePrompt()">Generate Prompt</button>
          <button onclick="copyToClipboard()">COPY</button>
        </div>
        <textarea class="output" id="finalPrompt"></textarea>
        <div class="labels-box" id="labelsBox"></div>
        <div class="preview-box" id="previewBox">
            <div id="canvas" class="preview-canvas"></div>
            
          </div>
          <div class="moodboard-actions" style="
    margin-top: 1rem;
    display: flex;
   flex-wrap: wrap;
   gap: 0.75rem;
   align-items: center;
  justify-content: flex-end;
  background: #333;
  padding: 0.5rem;
  border-radius: 8px;
">
  <!-- LEFT-ALIGNED: File input -->
  <div style="margin-right: auto;">
    <input type="file" multiple accept="image/*" onchange="handleMoodboardUpload(event)" style="max-width: 180px;" />
    
  </div>

  <!-- REST: Right-aligned tools -->

  <button style="background-color: white; color: black;" onclick="downloadAllImagesAsZip()">Download Images</button>

  <button style="background-color: white; color: black;" onclick="downloadCanvasAsImage()">Download Canvas</button>
</div> 
          <div>
            <button style="background-color: white; color: black;margin-top: 1rem;" onclick="window.open('https://www.pinterest.com/search/pins/?q=' + encodeURIComponent(document.getElementById('pinterestSearch').value))">Open in Pinterest</button>
            <!-- <input type="text" id="pinterestSearch" style="background-color: white; color: black;margin-top: 1rem;" readonly /> -->
            <input type="text" id="pinterestSearch" style="flex: 1 1 auto; min-width: 250px; background-color: white; color: black;margin-top: 1rem;" readonly />
          </div>
</div>

<!-- JSZip CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>

    const sheetURL = 'https://docs.google.com/spreadsheets/d/1qXN1MR1pW3laS1wH_FI3vPblg3ANcqCMWVoGl0H7wek/export?format=csv';
    const pixabayKey = '49867384-e847c359e6df440fd86b28b9d';
    
    fetch(sheetURL).then(res => res.text()).then(csv => {
      const parsed = Papa.parse(csv, { header: true });
      const data = parsed.data;
      const keys = ['Office Space Type', 'IntendedUse', 'DesignStyle', 'Materials', 'AccentMaterials', 'PrimaryColor', 'AccentColors', 'LightingType', 'LightingElements'];
      keys.forEach(key => {
        const id = key.replace(/\s+/g, '').charAt(0).toLowerCase() + key.replace(/\s+/g, '').slice(1);
        const unique = [...new Set(data.map(row => row[key]).filter(v => v && v.trim() !== ""))];
        const select = document.getElementById(id);
        if (select) {
          select.innerHTML = unique.map(item => `<option value="${item}">${item}</option>`).join('');
        }
      });
    });
  
  
  function getMultiSelect(id) {
    return Array.from(document.getElementById(id)?.selectedOptions || []).map(opt => opt.value);
  }
  
  function generatePrompt() {
    const officeType = getMultiSelect('officeSpaceType');
    const intendedUse = getMultiSelect('intendedUse');
    const designStyle = getMultiSelect('designStyle');
    const people = document.getElementById('people').value;
    const furniture = document.getElementById('furniture').value.trim();
    const materials = getMultiSelect('materials');
    const accentMaterials = getMultiSelect('accentMaterials');
    const primaryColor = getMultiSelect('primaryColor');
    const accentColors = getMultiSelect('accentColors');
    const lightingType = getMultiSelect('lightingType');
    const lightingElements = getMultiSelect('lightingElements');
  
    const promptParts = [];
    const intro = [];
    if (officeType.length) intro.push(`of a ${officeType.join(', ')} zone`);
    if (intendedUse.length) intro.push(`for ${intendedUse.join(', ')}`);
    if (designStyle.length) intro.push(`styled as ${designStyle.join(', ')}`);
    if (intro.length) promptParts.push(`Generate a photorealistic rendering ${intro.join(' ')}.`);
  
    const specs = [];
    if (people) specs.push(`Capacity: ${people} people`);
    if (furniture) specs.push(`Layout Elements: Include ${furniture}`);
    if (specs.length) promptParts.push(`\n\nSpace-Specific Requirements:\n${specs.join('. ')}`);
  
    const materialsText = [];
    if (materials.length) materialsText.push(`Primary material: ${materials.join(', ')}`);
    if (accentMaterials.length) materialsText.push(`Accent material: ${accentMaterials.join(', ')}`);
    if (materialsText.length) promptParts.push(`\n\nMaterials & Textures: ${materialsText.join('; ')}`);
  
    const colorText = [];
    if (primaryColor.length) colorText.push(`Primary colors: ${primaryColor.join(', ')}`);
    if (accentColors.length) colorText.push(`Accent colors: ${accentColors.join(', ')}`);
    if (colorText.length) promptParts.push(`\n\nColor Palette: ${colorText.join('; ')}`);
  
    const lightingText = [];
    if (lightingType.length) lightingText.push(`Type: ${lightingType.join(', ')}`);
    if (lightingElements.length) lightingText.push(`Elements: ${lightingElements.join(', ')}`);
    if (lightingText.length) promptParts.push(`\n\nLighting: ${lightingText.join('; ')}`);
  
    promptParts.push("\n\nEnsure ambient lighting creates a sophisticated and welcoming feel.");
    document.getElementById('finalPrompt').value = promptParts.join('');
  }
    
  function copyToClipboard() {
    const text = document.getElementById('finalPrompt').value;
    navigator.clipboard.writeText(text).then(() => alert('Copied!'));
  }
    const scrollableForm = document.querySelector('.scrollable-form');
    
    const outputSection = document.querySelector('.output-section');
  
    outputSection.addEventListener('wheel', function (e) {
      if (scrollableForm) {
        scrollableForm.scrollBy({
          top: e.deltaY,
          behavior: 'auto'
        });
      }
      e.preventDefault(); // prevent scroll on right side
    }, { passive: false });

    const canvas = document.getElementById('canvas');
    let scale = 1;
    let isDraggingCanvas = false;
    let canvasOffsetX = 0, canvasOffsetY = 0, dragStartX = 0, dragStartY = 0;
  
    // function handleMoodboardUpload(event) {
    //   const files = event.target.files;
    //   Array.from(files).forEach(file => {
    //     const reader = new FileReader();
    //     reader.onload = function (e) {
    //       const wrapper = document.createElement('div');
    //       wrapper.className = 'preview-image-wrapper';
    //       wrapper.style.width = '200px';
    //       wrapper.style.height = '200px';
    //       wrapper.style.left = `${Math.random() * 600}px`;
    //       wrapper.style.top = `${Math.random() * 300}px`;
  
    //       const img = document.createElement('img');
    //       img.src = e.target.result;
    //       wrapper.appendChild(img);
    //       canvas.appendChild(wrapper);
    //       makeDraggable(wrapper);
    //     };
    //     reader.readAsDataURL(file);
    //   });
    // }

    function handleMoodboardUpload(event) {
  const files = event.target.files;
  const canvas = document.getElementById('canvas');

  

  const cellWidth = 200;
  const cellHeight = 200;
  const margin = 15;
  const canvasPadding = 40;
  const maxPerRow = Math.floor((canvas.offsetWidth - canvasPadding) / (cellWidth + margin));
  
  let imageCount = canvas.querySelectorAll('.preview-image-wrapper').length;

  Array.from(files).forEach((file, i) => {
    const reader = new FileReader();
    reader.onload = function (e) {
      const wrapper = document.createElement('div');
      wrapper.className = 'preview-image-wrapper';
      wrapper.style.width = `${cellWidth}px`;
      wrapper.style.height = `${cellHeight}px`;

      // Compute grid position
      const index = imageCount + i;
      const col = index % maxPerRow;
      const row = Math.floor(index / maxPerRow);
      wrapper.style.left = `${canvasPadding + col * (cellWidth + margin)}px`;
      wrapper.style.top = `${canvasPadding + row * (cellHeight + margin)}px`;

      const img = document.createElement('img');
      img.src = e.target.result;
      wrapper.appendChild(img);
      canvas.appendChild(wrapper);
      makeDraggable(wrapper);
      wrapper.addEventListener('click', function (e) {
  document.querySelectorAll('.preview-image-wrapper').forEach(el => el.classList.remove('selected-image'));
  wrapper.classList.add('selected-image');
  e.stopPropagation(); // prevent triggering drag
});

    };
    reader.readAsDataURL(file);
  });
}

  
function makeDraggable(wrapper) {
  let isDragging = false;
  let offsetX, offsetY;

  // Allow drag
  wrapper.addEventListener('mousedown', function (e) {
    if (e.target.tagName === 'TEXTAREA' || e.target.classList.contains('delete-btn')) return;

    // For selection logic
    const all = Array.from(document.querySelectorAll('.preview-image-wrapper'));

    // Ctrl/Cmd → toggle selection
    if (e.ctrlKey || e.metaKey) {
      wrapper.classList.toggle('selected');
      lastSelectedWrapper = wrapper;
    }
    // Shift → range selection
    else if (e.shiftKey && lastSelectedWrapper) {
      const start = all.indexOf(lastSelectedWrapper);
      const end = all.indexOf(wrapper);
      const [min, max] = [Math.min(start, end), Math.max(start, end)];
      all.forEach((el, i) => {
        if (i >= min && i <= max) el.classList.add('selected');
      });
    }
    // Regular click → single selection
    else {
      all.forEach(el => el.classList.remove('selected'));
      wrapper.classList.add('selected');
      lastSelectedWrapper = wrapper;
    }

    // Enable drag
    isDragging = true;
    offsetX = e.clientX - wrapper.offsetLeft;
    offsetY = e.clientY - wrapper.offsetTop;
    wrapper.style.zIndex = 1000;
    e.stopPropagation();
  });

  document.addEventListener('mousemove', function (e) {
    if (!isDragging) return;
    const selectedWrappers = document.querySelectorAll('.preview-image-wrapper.selected');
    selectedWrappers.forEach(el => {
      el.style.left = `${e.clientX - offsetX}px`;
      el.style.top = `${e.clientY - offsetY}px`;
    });
  });

  document.addEventListener('mouseup', function () {
    isDragging = false;
    wrapper.style.zIndex = '';
  });

  // Right-click to remove
  wrapper.addEventListener('contextmenu', e => {
    e.preventDefault();
    if (confirm("Remove this image?")) wrapper.remove();
  });
}

  
    const previewBox = document.getElementById('previewBox');
    previewBox.addEventListener('wheel', function(e) {
        // Allow zooming or internal canvas scroll (if needed), but stop propagation
        e.stopPropagation();
      }, { passive: false });

    
  
    previewBox.addEventListener('wheel', function (e) {
      e.preventDefault();
      const delta = e.deltaY > 0 ? -0.1 : 0.1;
      const prevScale = scale;
      scale += delta;
      scale = Math.max(0.3, Math.min(scale, 3));
  
      const rect = previewBox.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
  
      canvasOffsetX = x - ((x - canvasOffsetX) / prevScale) * scale;
      canvasOffsetY = y - ((y - canvasOffsetY) / prevScale) * scale;
  
      updateCanvasTransform();
    }, { passive: false });
  
    previewBox.addEventListener('mousedown', function (e) {
      if (e.target !== previewBox) return;
      isDraggingCanvas = true;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      previewBox.style.cursor = 'grabbing';
    });
  
    document.addEventListener('mousemove', function (e) {
      if (!isDraggingCanvas) return;
      canvasOffsetX += (e.clientX - dragStartX);
      canvasOffsetY += (e.clientY - dragStartY);
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      updateCanvasTransform();
    });
  
    document.addEventListener('mouseup', function () {
      isDraggingCanvas = false;
      previewBox.style.cursor = 'grab';
    });
  
    function updateCanvasTransform() {
      canvas.style.transform = `translate(${canvasOffsetX}px, ${canvasOffsetY}px) scale(${scale})`;
    }



    // Paste from clipboard to moodboard
document.addEventListener('paste', async (event) => {
  const items = event.clipboardData?.items || [];
  for (const item of items) {
    if (item.type.indexOf('image') !== -1) {
      const blob = item.getAsFile();
      const reader = new FileReader();
      reader.onload = function (e) {
        const wrapper = document.createElement('div');
        wrapper.className = 'preview-image-wrapper';
        wrapper.style.width = '200px';
        wrapper.style.height = '200px';
        wrapper.style.left = `${Math.random() * 600}px`;
        wrapper.style.top = `${Math.random() * 300}px`;

        const img = document.createElement('img');
        img.src = e.target.result;
        wrapper.appendChild(img);
        canvas.appendChild(wrapper);
        makeDraggable(wrapper);
      };
      reader.readAsDataURL(blob);
      event.preventDefault();
      break;
    }
  }
});

function downloadAllImagesAsZip() {
  const zip = new JSZip();
  const images = document.querySelectorAll('#previewBox .preview-image-wrapper img');
  const promises = [];

  images.forEach((img, index) => {
    const url = img.src;
    const filename = `image${index + 1}.png`;
    const promise = fetch(url)
      .then(res => res.blob())
      .then(blob => zip.file(filename, blob));
    promises.push(promise);
  });

  Promise.all(promises).then(() => {
    zip.generateAsync({ type: "blob" }).then(content => {
      saveAs(content, "moodboard_images.zip");
    });
  });
}

function downloadCanvasAsImage() {
  const canvasEl = document.getElementById('canvas');
  const wrappers = canvasEl.querySelectorAll('.preview-image-wrapper');

  if (wrappers.length === 0) return;

  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;

  wrappers.forEach(el => {
    const left = parseFloat(el.style.left);
    const top = parseFloat(el.style.top);
    const width = el.offsetWidth;
    const height = el.offsetHeight;

    minX = Math.min(minX, left);
    minY = Math.min(minY, top);
    maxX = Math.max(maxX, left + width);
    maxY = Math.max(maxY, top + height);
  });

  const width = maxX - minX;
  const height = maxY - minY;

  // Clone canvas and trim to bounding box
  const clone = canvasEl.cloneNode(true);
  clone.style.position = 'absolute';
  clone.style.top = '0';
  clone.style.left = '0';
  clone.style.transform = 'none';
  clone.style.width = `${width}px`;
  clone.style.height = `${height}px`;
  clone.style.overflow = 'hidden';

  clone.querySelectorAll('.preview-image-wrapper').forEach(el => {
    el.style.left = `${parseFloat(el.style.left) - minX}px`;
    el.style.top = `${parseFloat(el.style.top) - minY}px`;
  });

  document.body.appendChild(clone);

  html2canvas(clone, {
    backgroundColor: '#222',
    width: width,
    height: height,
    scale: 2
  }).then(canvas => {
    document.body.removeChild(clone);
    canvas.toBlob(blob => {
      saveAs(blob, 'moodboard_cropped.png');
    });
  });
}




async function handleSearch(selectElement, context) {
    // const selectedOptions = Array.from(selectElement.selectedOptions);
    // if (selectedOptions.length === 0) return;
    // const query = `${selectedOptions[selectedOptions.length - 1].value} ${context}`;
    // const previewBox = document.getElementById('previewBox');
    // previewBox.innerHTML = `Searching for “${query}”...`;
    // try {
    //   const res = await fetch(`https://pixabay.com/api/?key=${pixabayKey}&q=${encodeURIComponent(query)}&image_type=photo&orientation=horizontal`);
    //   const data = await res.json();
    //   const image = data.hits?.[0];
    //   previewBox.innerHTML = image ? `<img src="${image.webformatURL}" alt="${query}" class="preview-image">` : 'No image found.';
    // } catch (err) {
    //   previewBox.innerHTML = 'Error fetching image.';
    // }
  }
  
  function updateLabels() {
    const keys = ['officeSpaceType','intendedUse','designStyle','people','furniture','materials','accentMaterials','primaryColor','accentColors','lightingType','lightingElements'];
    const labelsBox = document.getElementById('labelsBox');
    labelsBox.innerHTML = '';
    keys.forEach(id => {
      const el = document.getElementById(id);
      const values = el.tagName === 'SELECT' && el.multiple ? getMultiSelect(id) : [el.value];
      values.forEach(val => {
        if (val && val.trim()) {
          const span = document.createElement('span');
          span.className = 'label-tag label-' + id;
          span.innerHTML = `${val}<span class="remove" onclick="removeLabel('${id}', '${val}')">×</span>`;
          labelsBox.appendChild(span);
        }
      });
    });
  }
  
  function removeLabel(id, value) {
    const el = document.getElementById(id);
    if (el.tagName === 'SELECT' && el.multiple) {
      Array.from(el.options).forEach(opt => { if (opt.value === value) opt.selected = false; });
    } else if (el.tagName === 'TEXTAREA' || el.tagName === 'INPUT') {
      el.value = '';
    }
    updateLabels();
    generatePrompt();
  }
  
  function updatePinterestQuery() {
    const design = getMultiSelect('designStyle')[0];
    const office = getMultiSelect('officeSpaceType')[0];
    const color = getMultiSelect('primaryColor')[0];
    const lighting = getMultiSelect('lightingType')[0];
  
    const searchInput = document.getElementById('pinterestSearch');
  
    const parts = [];
    if (design) parts.push(`${design} office`);
    if (office) parts.push(`${office}`);
    if (color) parts.push(`with ${color} as primary color`);
    if (lighting) parts.push(`and ${lighting} lighting`);
  
    searchInput.value = parts.join(' ');
  }
  function focusMoodboardOnContent() {
  const images = document.querySelectorAll('#canvas .preview-image-wrapper');
  if (images.length === 0) return;

  let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;

  images.forEach(el => {
    const left = parseFloat(el.style.left);
    const top = parseFloat(el.style.top);
    const width = parseFloat(el.style.width) || el.offsetWidth;
    const height = parseFloat(el.style.height) || el.offsetHeight;

    minX = Math.min(minX, left);
    minY = Math.min(minY, top);
    maxX = Math.max(maxX, left + width);
    maxY = Math.max(maxY, top + height);
  });

  const contentWidth = maxX - minX;
  const contentHeight = maxY - minY;

  const previewBox = document.getElementById('previewBox');
  const boxWidth = previewBox.clientWidth;
  const boxHeight = previewBox.clientHeight;

  const padding = 80;
  const availableWidth = boxWidth - padding * 2;
  const availableHeight = boxHeight - padding * 2;

  scale = Math.min(availableWidth / contentWidth, availableHeight / contentHeight);
  scale = Math.max(0.3, Math.min(scale, 2)); // Clamp zoom

  canvasOffsetX = (boxWidth - contentWidth * scale) / 2 - minX * scale;
  canvasOffsetY = (boxHeight - contentHeight * scale) / 2 - minY * scale;

  updateCanvasTransform();
}

document.addEventListener('keydown', function (e) {
  if (e.key === 'f' || e.key === 'F') {
    focusMoodboardOnContent();
  }
});

document.addEventListener('keydown', function (e) {
  if (e.key === 'Delete') {
    document.querySelectorAll('.preview-image-wrapper.selected').forEach(el => el.remove());
  }
});



  
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>



  
</body>
</html>
